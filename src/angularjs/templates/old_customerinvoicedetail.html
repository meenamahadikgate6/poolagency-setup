<!--div  style="height:3.875in;width:8.875in;border:1px solid #000; top:0;left:0; position:absolute; z-index: 9999;">
    <div style="
    border: 1px solid #000;
    width: 3.5in;
    height: 0.875in;
    margin-left: 0.375in;
    margin-top: 0.5in;
    position: fixed;
"></div>
        <div style="
    border: 1px solid #000;
    width: 3.5in;
    height: 1in;
    margin-left: 0.875in;
    margin-bottom: 0.625in;
    margin-top: 2.25in;
    position: fixed;
"></div>
</div-->  
<div class="white-bg text-left p-20 p-relative m-b20 invoice-wrapper" style="min-height:800px;" ng-init="getInvoiceDetails()">
    <div class="spinner" ng-if="isProcessing">
        <div class="spinner-item">
          <div class="spinner-animation"><img border="0" src="resources/images/spinner.gif" /></div>
        </div>
    </div>
    <div class="remove-for-print p-relative" >
        <div style="position: absolute; z-index: 1; left: 0px; top: -30px; right: 0; padding: 0px; ">
            <success ng-if="successMsg" message="{{successMsg}}"></success>
            <error ng-if="error" message="{{error}}"></error>
        </div>
    </div>
    <div class="customer second-address-print add-for-print">
        <a href="{{invoiceDetails.billingDetails.isPrimary ? '/app/customerdetail/' : '/app/locationdetail/' }}{{invoiceDetails.billingDetails.addressId}}" class="i-title print-clr-dark print-22x remove-for-print">{{invoiceDetails.billingDetails.name}}</a>
        <a href="javascript:void(0)" class="i-title print-clr-dark print-20x add-for-print">{{invoiceDetails.billingDetails.name}}</a>
        <div class="h-2x print-16x">
            {{invoiceDetails.billingDetails.address}}</br>
            {{invoiceDetails.billingDetails.city}}, {{invoiceDetails.billingDetails.state}} {{invoiceDetails.billingDetails.zipCode}}
        </div>
        <p class="h-0-5x remove-for-print">
            <span ng-if="invoiceDetails.billingDetails.phone">
            <phone-Number number="{{invoiceDetails.billingDetails.phone}}"></phone-Number><br /></span>
            <span  ng-if="invoiceDetails.billingDetails.email">{{invoiceDetails.billingDetails.email}}</span>
        </p>
    </div> 
    <div class="col-md-5 service-address-print add-for-print">   
        <div ng-repeat="invoice in invoiceDetails.details">             
            <div class="sub-title-custom">Service Address</div>                
            <div class="h-2x print-16x">
                {{invoice.serviceAddress.address}}</br>
                {{invoice.serviceAddress.city}}, {{invoice.serviceAddress.state}} {{invoice.serviceAddress.zipCode}}
            </div> 
        </div>               
    </div>   
    <div ng-if="invoiceNotFoundStatus" class="invoice-not-found">
        {{invoiceNotFoundText}}
    </div>
    <div ng-if="!invoiceNotFoundStatus" class="container-fluid invoice-detail-page darkGray">        
        <div class="envalop-window-wrapper">
            <div class="row add-for-print print-top-header">
                <div class="col-md-6 company-add">
                    <div class="flex">
                        <div ng-if="invoiceDetails.companyDetails.logo">
                            <img style="max-width: 150px!important; max-height:100px; padding-right: 20px;" src="{{invoiceDetails.companyDetails.logo}}" />
                        </div>                   
                        <div class="customer">
                        
                            <div class="h-2x print-16x">
                                {{invoiceDetails.companyDetails.address}}</br>
                                {{invoiceDetails.companyDetails.city}}, {{invoiceDetails.companyDetails.state}} {{invoiceDetails.companyDetails.zipCode}}
                            </div>
                            <p class="h-2x print-16x">
                                <phone-Number ng-if="invoiceDetails.companyDetails.phone" number="{{invoiceDetails.companyDetails.phone}}"></phone-Number>                      
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="col-md-12">  
                        <div class="h-3x text-right">
                            <strong>Invoice #{{invoiceDetails.invoiceNumber}}</strong>
                            <span class="p-l20">{{invoiceDetails.createdOn | convertDateOffset: companyTimeZone: 'MM/dd/yy'}}</span>                
                        </div>
                    </div>
                    <div class="col-md-12 text-right">  
                        <p class="upperCase h-2x darkGray p-t10"><strong>DUE ON {{invoiceDetails.dueDate | convertDateOffset: companyTimeZone: 'MM/dd/yy'}}</strong></p>
                        <div ng-if="invoiceDetails.invoiceStatus == 'Past Due'" class="status upperCase {{invoiceDetails.invoiceStatus}}">
                            {{invoiceDetails.invoiceStatus}}
                        </div>
                    </div>
                </div>
            </div>
            <div class="row top-section">
                <success ng-if="successProductForm" message="{{successProductForm}}"></success>
                <error message="{{errorProductForm}}" ng-if="errorProductForm"></error>
                <div class="col-md-1 add-for-print"><br/><br/></div>
                <div class="col-md-5">                               
                    <div class="customer remove-for-print ">
                        <a href="{{invoiceDetails.billingDetails.isPrimary ? '/app/customerdetail/' : '/app/locationdetail/' }}{{invoiceDetails.billingDetails.addressId}}" class="i-title print-clr-dark print-22x remove-for-print">{{invoiceDetails.billingDetails.name}}</a>
                        <a href="javascript:void(0)" class="i-title print-clr-dark print-20x add-for-print">{{invoiceDetails.billingDetails.name}}</a>
                        <div class="h-2x print-16x">
                            {{invoiceDetails.billingDetails.address}}</br>
                            {{invoiceDetails.billingDetails.city}}, {{invoiceDetails.billingDetails.state}} {{invoiceDetails.billingDetails.zipCode}}
                        </div>
                        <p class="h-0-5x remove-for-print">
                            <span ng-if="invoiceDetails.billingDetails.phone">
                            <phone-Number number="{{invoiceDetails.billingDetails.phone}}"></phone-Number><br /></span>
                            <span  ng-if="invoiceDetails.billingDetails.email">{{invoiceDetails.billingDetails.email}}</span>
                        </p>
                    </div>                
                </div>
                <div class="col-md-1 add-for-print"></div>
                <div class="col-md-7 remove-for-print">
                    <div class="row">
                        <div class="col-md-5 text-center flex ">
                            <div class="m-r20">
                                <span ng-class="{'viewed-on sent-on': sentOnData.length > 0}">
                                    <i ng-click="showEmailInvoicePopup()" class="fa fa-envelope icon-large pointer light-blue"></i>      
                                    <div ng-if="sentOnData.length > 0" class="h-12x">  
                                            Sent {{sentOnData[0].sentOn | convertDateOffset: companyTimeZone: 'MM/dd/yy' }}
                                    </div>
                                    <div ng-if="sentOnData.length == 0" class="h-12x"  >
                                            Not Sent 
                                    </div>
                                    <div class="e-tooltip" ng-if="sentOnData.length > 0">
                                        <strong>EMAIL SENT</strong> 
                                        <div ng-repeat="data in sentOnData" class="m-b5">                                        
                                            <div ><span ng-if="data.userName !== null">{{data.userName}}</span><span ng-if="data.userName === null">Automated</span> - <span class="lowerCase">{{data.sentOn | convertDateOffset: companyTimeZone: 'MM/dd/yy - h:mm a'}}</span></div>                                           
                                            <div class="break-word" ng-if="data.email">({{data.email}})</div>                
                                        </div>
                                    </div> 
                                </span>
                            </div>
                            <div >
                                <span ng-if="viewedOnData.length > 0" class="viewed-on">
                                    <i class="fa fa-eye icon-large pointer light-blue"></i>
                                    <div class="h-12x">                                  
                                        Viewed {{viewedOnData[0].viewedOn | convertDateOffset: companyTimeZone: 'MM/dd/yy' }}
                                    </div> 
                                    <div class="e-tooltip">
                                        <strong>CUSTOMER VIEWED</strong> 
                                        <div ng-repeat="data in viewedOnData" class="lowerCase">{{data.viewedOn |  convertDateOffset: companyTimeZone: 'MM/dd/yy - h:mm a' }}</div>
                                    </div> 
                                </span>
                                <span ng-if="viewedOnData.length == 0" class="light-grey">
                                    <i class="fa fa-eye icon-large pointer"></i>                           
                                    <div class="h-12x">
                                        Not Viewed 
                                    </div>
                                </span>
                            </div>             
                        </div>
                        <div class="col-md-7">
                            
                            <div class="flex justify-content-flex-end">
                                <div  class="m-r20">
                                    <div class="flex align-items-center">
                                        <span ng-click="generatePdf()" class="custom-pdf-icon m-r20">PDF</span>
                                        <i class="fa fa-print light-blue icon-large pointer" ng-click="printInvoice()"></i>
                                    </div>
                                
                                </div>
                                <div class="text-right m-l20">
                                    <button ng-disabled="invoiceDetails.invoiceStatus == 'Paid' || !invoiceDetails.totalAmount" ng-click="invoiceDetails.invoiceStatus == 'Paid' ? null : getPaymentProfile()" type="button" class="btn btn-take-payment {{invoiceDetails.invoiceStatus == 'Paid' && 'paid'}}">{{invoiceDetails.invoiceStatus == 'Paid' ? 'Paid' : 'Take Payment'}}</button>
                                    <p class="upperCase h-2x darkGray p-t10 "><strong>DUE ON {{invoiceDetails.dueDate | convertDateOffset: companyTimeZone: 'MM/dd/yy'}}</strong></p>
                                    <div ng-if="invoiceDetails.invoiceStatus == 'Past Due'" class="status upperCase {{invoiceDetails.invoiceStatus}}">
                                        {{invoiceDetails.invoiceStatus}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div> 
                           
            </div>
        </div>
        <div class="row bottom-section" ng-repeat="invoice in invoiceDetails.details">
            
            <div class="col-md-5 remove-for-print m-b20">                   
                <div class="sub-title-custom">Service Address</div>                
                <div class="h-2x">
                    {{invoice.serviceAddress.address}}</br>
                    {{invoice.serviceAddress.city}}, {{invoice.serviceAddress.state}} {{invoice.serviceAddress.zipCode}}
                </div>                
            </div>
            <div class="col-md-7">
                <div class="invoice-edit-delete" ng-if="canEditInvoice ==1 && invoiceDetails.invoiceStatus != 'Paid' && showAddProduct && showItemPrint ">
                    <a class="btn" ng-click="addBundleProductSearch()"> Add <i class="fa fa-plus-circle "></i></a>
                  </div>
            </div>
      <!--      <div class="col-md-12" ng-if="invoiceDetails.invoiceType != 'OneOffJob'">
                <div class="row">      
                    <div class="col-md-3 col-xs-12 m-b20">
                        <div class="sub-title-date p-t0 p-l0">Service Date</div>
                    </div>     
                </div>
                <div class="row">                   
                    <div class="col-md-3 m-b20"> 
                        <div ng-repeat="waterBody in invoice.serviceDetails">
                            <div ng-if="waterBody.customerPayType == 'Per Visit'" class="print-18x" ng-repeat="job in waterBody.jobDetails" ng-init="uniqueDate(job)">
                                <div ng-if="$parent.$parent.$last && $parent.$last && $parent.$parent.$parent.$first" ng-repeat="date in jobArray track by $index" >{{date | date: 'MM/dd/yy' }}</div>
                            </div>   
                        
                            <div class="nowrap" ng-if="((waterBody.customerPayType == 'Monthly Flat Rate' && invoiceDetails.invoiceTo && invoiceDetails.invoiceFrom) || (waterBody.jobDetails.length == 0 && invoice.serviceTotalAmount.totalAmount == 0 )) && $index==0" class="print-18x">
                            <div  ng-if="waterBody.jobDetails.length == 0">No route stops from </div>  {{invoiceDetails.invoiceFrom | date: 'MM/dd/yy' }} - {{invoiceDetails.invoiceTo | date: 'MM/dd/yy' }}                          
                            </div>
                        </div>
                    </div>
                    <div class="col-md-9" ng-if="!invoiceDetails.isInvoiceQBOSynced">
                        <div class="row" ng-repeat="waterBody in invoice.serviceDetails"> 
                            <div class="col-md-9">
                                <div class="h-2x print-20x"><strong>{{waterBody.waterBodyName}} - {{waterBody.serviceLevelTitle}}</strong> ({{waterBody.poolType}})</div>
                                <div class="h-1-5x print-16x">{{waterBody.serviceLevelDescription}}</div> 
                                <hr class="m-tb10" />
                            </div>
                            <div class="col-md-3">
                                <div class="text-right h-2x print-20x">{{waterBody.jobTotal ? waterBody.jobTotal : waterBody.jobRateTotal | currency}}</div>
                            </div>
                            <div class="col-md-12">
                            <div class="row" ng-if="waterBody.chemicalDetails.rows.length > 0">
                                <div class="m-t10 col-md-9">
                                    <label class="m-b0 h-2x print-20x">Chemicals Added for {{waterBody.waterBodyName}}</label>                          
                                    <div ng-repeat="chem in waterBody.chemicalDetails.rows" class="checmical-detail-in-invoice row">
                                        <span class="col-md-5">{{chem.keyValue}}</span> 
                                        <div class="col-md-7">
                                            <div class="row small-padding">
                                                <div class="col-md-8">{{chem.qty | number : '2'}} &nbsp;x&nbsp; {{chem.rate | currency}} <small>({{chem.unit}})</small></div> 
                                                <div class="col-md-1">=</div> 
                                                <div class="col-md-3 text-right print-20x">{{chem.total | currency}}</div>
                                            </div>                               
                                        </div>                             
                                    </div> 
                                    <hr class="m-t10 m-b20" />                                                 
                                </div>
                                <div class="col-md-3 m-t10" ng-if="waterBody.chemicalDetails.rows.length > 0">
                                    <div class="text-right h-2x print-20x">{{waterBody.chemicalDetails.total | currency}}</div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                    <div class="col-md-9" ng-if="invoiceDetails.isInvoiceQBOSynced">
                        <div class="row" ng-repeat="lineItem in invoice.lineData"> 
                            <div class="col-md-9">
                                <div class="h-2x print-20x"><strong>{{lineItem.title}}</strong></div>
                                <div class="h-1-5x print-16x"  style="white-space: pre-line">{{lineItem.description}}</div> 
                                <hr class="m-tb10" />
                            </div>
                            <div class="col-md-3">
                                <div class="text-right h-2x print-20x">{{lineItem.amount | currency}}</div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>  --> 

            <!-- <div class="col-md-12" ng-if="invoiceDetails.invoiceType == 'OneOffJob'"> -->
                <div class="col-md-12">

                    <div class="row" ng-if="invoiceDetails.invoiceType != 'Manual'">      
                        <div class="col-md-3 col-xs-12 m-b20">
                            <div class="sub-title-date p-t0 p-l0">Service Date <a href="javascript:void(0)" class="show ng-binding ng-scope" ng-if = "showItemPrint" ng-click="ShowHide($event)">Show</a> </div>
                        </div>     
                    </div>
                    <div class="row" ng-show = "IsVisible"  ng-if="invoiceDetails.invoiceType != 'Manual'">                   
                        <div class="col-md-3 m-b20"> 
                            <div ng-repeat="waterBody in invoice.serviceDetails">
                                <div ng-if="waterBody.customerPayType == 'Per Visit'" class="print-18x" ng-repeat="job in waterBody.jobDetails" ng-init="uniqueDate(job)">
                                    <div ng-if="$parent.$parent.$last && $parent.$last && $parent.$parent.$parent.$first" ng-repeat="date in jobArray track by $index" >{{date | date: 'MM/dd/yy' }}</div>
                                </div>   
                            
                                <div class="nowrap" ng-if="((waterBody.customerPayType == 'Monthly Flat Rate' && invoiceDetails.invoiceTo && invoiceDetails.invoiceFrom) || (waterBody.jobDetails.length == 0 && invoice.serviceTotalAmount.totalAmount == 0 )) && $index==0" class="print-18x">
                                <div  ng-if="waterBody.jobDetails.length == 0">No route stops from </div>  {{invoiceDetails.invoiceFrom | date: 'MM/dd/yy' }} - {{invoiceDetails.invoiceTo | date: 'MM/dd/yy' }}                          
                                </div>
                            </div>
                        </div>
                    </div>
                        
                    <div class="row">                   
                    <div class="col-md-3 m-b20"> 
                        &nbsp;
                    </div>
                    <div class="col-md-9">
                        <div class="row">      
                            <div class="col-md-6 col-xs-12 m-b20">
                                &nbsp;
                            </div>
                            <div class="col-md-2 col-xs-12 m-b20 text-center">
                                QTY
                            </div>
                            <div class="col-md-2 col-xs-12 m-b20">
                                PRICE
                            </div>
                            <div class="col-md-2 col-xs-12 m-b20">
                                AMOUNT
                            </div>     
                        </div>
                    </div>
                </div>
            
                <div class="row">                   
                    <div class="col-md-3 m-b20">
                        <div class="sub-title-custom" ng-if="invoiceDetails.invoiceType == 'Manual'">Service Date <a href="javascript:void(0)" class="show ng-binding ng-scope" ng-click="ShowHide($event)">Show</a> </div>   
                        <span ng-show = "IsVisible" ng-if="invoiceDetails.invoiceType == 'Manual'" style="position: absolute; top: 33px;">{{invoiceDetails.createdOn | convertDateOffset: companyTimeZone: 'MM/dd/yy'}}</span>
                    </div>

                    <div class="col-md-9 invoice-edit-delete-main">

                        
                          <div class="grey-box invoice-box">

              <table class="product-services-list invoice-list" style="width:100%" ng-if = "showItemPrint">
                <tbody ng-if="productNoItem">
                  <tr><td colspan="5" style="text-align:center"> <strong>No item in list</strong> </td></tr>
                </tbody> 
                <tbody ng-if="bundleSearchForm">
                  <tr>
                    <td colspan="5" class="bundle-search">
                      <div class="bundle-search-box" ng-if="bundleSearchForm">
                          <span class="search-icon"></span>
                          <input type="search" id="bundleSearchText" placeholder="Product or service name/part number" ng-model="bundleSearchText" class="form-control" ng-keyup="showListForBundle(bundleSearchText)" ng-blur="hideSearchBar()">
                          <a href="" class="close-search-bar" ng-click="hideSearchBar()"><i class="fa fa-times"></i></a>
                      </div>
                      <table id="product-list" ng-if="isBundleSearch">
                        <tbody ng-if="productBundleList.length > 0" ng-repeat="productBundleListCategory in productBundleList" ng-class-odd="'odd'" ng-class-even="'even'" ng-class="">                              
                          <tr class="even" style="cursor: pointer;" ng-click="addProductToBundle(productBundleListCategory)">
                            <td><div class="product-sevices-category" ng-class="productBundleListCategory.category"></div></td>
                            <td>{{productBundleListCategory.name}}<br>
                                <span style="color: #9b9999;font-size: 11px;" ng-if="productBundleListCategory.sku" class="ng-binding ng-scope">part #{{productBundleListCategory.sku}}
                                </span></td>
                            <td style="text-align:center ;">{{productBundleListCategory.price | currency}}</td>
                          </tr>                            
                        </tbody>
                        <tbody ng-if="productBundleList.length == 0">
                            <tr><td>No result to display</td></tr>
                        </tbody>
                      </table>
                    </td>
                  </tr>
                </tbody>
                <tbody ng-repeat="productBundleListNewCategory in productBundleListNew" ng-if="productBundleList.length > 0" class="productBundleListNew">
                  <tr><td colspan="5"></td></tr>
                  <tr>
                    <td>
                        <div class="row">  	
                            <div class="col-md-6"><div class="product-sevices-category" ng-class="productBundleListNewCategory.category">{{productBundleListNewCategory.name}}<br>{{productBundleListNewCategory.sku}}</div></div>	
                            <div class="col-md-2"><input type="number" class="form-control input-number form-control-small bundle-qty" ng-model="productBundleListNewCategory.qty" ng-keyup="calculateBundleCost()" style="margin: auto;" /></div>	
                            <div class="col-md-2"></div>	
                            <div class="col-md-2">{{productBundleListNewCategory.qty==0 || !productBundleListNewCategory.qty? productBundleListNewCategory.price : productBundleListNewCategory.price * productBundleListNewCategory.qty | currency}}</div>	
                        </div>
                    </td>
                  </tr>
                  <!-- <tr class="even" style="cursor: pointer;">
                    <td><button class="btn btn-primary" ng-click="saveInvoiceItem()">Save </button><button class="btn btn-primary btn-bordered" ng-click="cancelInvoiceItem()">Cancel </button></td>
                    <td style="text-align:center"><button class="btn btn-primary button red-bg" ng-click="" style="background-color: #ff0000;">Delete </button></td>
                  </tr>-->
                </tbody>                   
              </table>
    
              <table class="product-services-list" style="width:100%">
                <tbody ng-repeat="lineItem in invoice.lineData" class="edit-invoice">
                  <tr><td colspan="5"></td></tr>
                  <tr>
                      <td colspan="5">
                        <div class="row">
                            <div class="col-md-6 title-invoice">
                                <p class = "install-invoice"> <a href="javascript:void(0)" ng-if="canEditInvoice ==1 && invoiceDetails.invoiceStatus != 'Paid'" class="ng-binding ng-scope title-invoice-edit" ng-click="ShowHideTextField($index)" >edit</a> {{lineItem.title}}</p>
                    <input ng-show = "IsTextFieldVisible[$index]" type="description" class="form-control description-input" ng-model="lineItem.description" /><span style="font-size: 18px;font-weight: normal;line-height: 1;" ng-hide = "IsTextFieldVisible[$index]" >{{lineItem.description}}</span>
                            </div>
                            <div class="col-md-2" style="text-align:center;">
                                <div ng-hide = "IsTextFieldVisible[$index]" ng-model="lineItem.qty">{{lineItem.qty}}</div>
                                    <input class="form-control input-number form-control-small bundle-qty quantity-input " ng-model="lineItem.qty" style="margin: auto;" ng-if="canEditInvoice ==1" ng-show = "IsTextFieldVisible[$index]" min="1"  allow-typing="^[0-9. ]+$" />
                                    <error message="{{errorProductFormQty[$index]}}" class = "quantity-error"ng-if="errorProductFormQty[$index]"></error>
                            </div>
                            <div class="col-md-2" style="text-align:left;" >
                                <span ng-hide = "IsTextFieldVisible[$index]" ng-model="lineItem.unitPrice">{{lineItem.unitPrice | currency}}</span>
                                <input type="text" format="currency"  class="form-control input-number form-control-small unitPrice-input" ng-model="lineItem.unitPrice" ng-if="canEditInvoice ==1" ng-show = "IsTextFieldVisible[$index]" style="width: 100%;" allow-typing="^[$,0-9. ]+$" />
                            </div>
                            <div class="col-md-2">{{lineItem.qty==0 || !lineItem.qty? lineItem.amount : lineItem.unitPrice * lineItem.qty | currency}}</div>
                        </div>

                      </td>
                    <!-- <td><div class="product-sevices-category" ng-class="lineItem.category"></div></td> -->
                <!-- <p class = "install-invoice">Install Tristar VS 900 Pool Pump</p>  -->
                 

                    <!-- <p style = "font-size: 23px;font-weight: 500;" >Tristar VS 900 Pool Pump</p>
                <span class = pump>New Hayward Tristar VS 900 Pool Pump</span>
                <h4 class = "pump-head">Labor</h4>
                <label style="color:blue">Individual prices hidden<a href="javascript:void(0)" class="icon-required checklist-help" style="margin-left: 10px;">
                   <i class="fa fa-question-circle" aria-hidden="true"></i>
                   <span class="sch-help"><p>lorem ipsum</p></span>
                 </a></label>   -->
                 <!-- ng-keyup="calculateBundleCostAndSave(lineItem)" -->
                    
                    
                  </tr>
                  <tr ng-if="lineItem.bundleItemReference">
                      <td colspan="5">
                    <table class="product-services-list table-two" style="width:100%">
                        <tbody ng-repeat="bundleItem in lineItem.bundleItemReference" >
                          <tr>
                            <td colspan="5">
                                <div class="row">
                                    <div class="col-md-6"><h3 class="bundleItem-title">{{bundleItem.title}}</h3><p class="bundleItem-content">{{bundleItem.description}}</p></div>
                                    <div class="col-md-2" style="text-align:center"><span ng-if="lineItem.bundleItemReference">{{bundleItem.qty}}</span></div>
                                    <!-- <div class="col-md-2" style="text-align:center;">
                                        <span ng-hide = "IsBunddleVisible[$index]" ng-model="lineItem.qty">{{bundleItem.qty}}</span>
                                        <input type="number" class="form-control input-number form-control-small bundle-qty quantity-input " ng-model="bundleItem.qty" style="margin: auto;" ng-if="canEditInvoice ==1" ng-show = "IsBunddleVisible[$index]" min="1" />
                                        <error message="{{errorProductFormQty[$index]}}" class = "quantity-error"ng-if="errorProductFormQty[$index]"></error>
                                    </div> -->
                                    <div class="col-md-2" style="text-align:left"><span ng-class="lineItem.bundleItemReference && lineItem.showIndividualPrice==1 ? 'active' : 'inactive'">{{bundleItem.unitPrice | currency}}</span></div>
                                    <div class="col-md-2" ng-class="lineItem.bundleItemReference && lineItem.showIndividualPrice==1 ? 'active' : 'inactive'">{{bundleItem.amount | currency}}</div>
                                </div>
                                
                            </td>
                            
                          </tr>
                          </tbody>
                          </table>
                  </td> </tr>
                  <tr class="even">
                    <td colspan="4" ng-if="lineItem.bundleItemReference && lineItem.showIndividualPrice==0 && showItemPrint">
                        <div class="row p-l20">
                            <div class="col-md-12">
                                <a  ng-click="showIndPrice(lineItem, $index)" ><label class="price-shown" >Individual prices hidden
                                       <a href="javascript:void(0)" class="icon-required"> <i class="fa fa-question-circle" aria-hidden="true"></i>
                                        <span class="sch-help" style="width: 128px !important"><p>lorem ipsum</p></span></a>
                                      <!--  <span class="sch-help" style="width: 200px;">lorem ipsum</span> -->
                                </label></a>
                            </div>
                        </div>
                    </td>
                    <td colspan="4" ng-if="lineItem.bundleItemReference && lineItem.showIndividualPrice==1 && showItemPrint">
                        <a ng-click="hideIndPrice(lineItem, $index)" ><label class = "price-hidden" >Individual prices shown <a href="javascript:void(0)" class="icon-required"> <i class="fa fa-question-circle" aria-hidden="true"></i>
                        <!-- <span class="sch-help"></span> --> 
                        <span class="sch-help" style="width: 128px !important"><p>lorem ipsum</p></span></a>
                    </label></a>
                    </td>
                        <!-- <button class="btn btn-primary button red-bg" ng-if="canEditInvoice ==1" ng-click="deleteLineDataAndSave(lineItem)" style="background-color: #ff0000;">Delete </button> -->
                    <!-- <td><button class="btn btn-primary button blue-bg" ng-click="">Cancel </button></td> -->
                </tr>
                <tr>
                    <td style="text-align:center" ng-if="canEditInvoice == 1" ng-show = "IsTextFieldVisible[$index]" >
                        <div class="row">
                            <div class="col-md-6 text-left">
                                <button class="btn btn-primary" ng-click="calculateBundleCostAndSave(lineItem, $index)">Save </button>
                                <button class="btn btn-primary btn-bordered" ng-click="ShowHideTextField($index)"> cancel</button>
                            </div>
                            <div class="col-md-6 text-right">
                                <button class="btn btn-danger" ng-click="deleteLineDataAndSave(lineItem, $index)">Delete </button>
                            </div>
                        </div>
                    </td>
                        
                  </tr>
                  <tr><td><hr style="margin: 0;"></td></tr>
                </tbody>                   
              </table>
                    </div>
                </div>   
                        
                    </div>
                </div>  
            </div>

            <!--div class="col-md-12 m-t20" ng-if="invoice.serviceTotalAmount.discountValue">
                <div class="row">
                    <div class="col-md-3">
                        &nbsp;
                    </div>                   
                    <div class="col-md-7">
                        <div class="h-2x print-20x"><strong>Discount</strong></div>
                        <div class="h-1-5x print-16x">{{invoice.serviceTotalAmount.discountTitle}}</div>
                    </div>
                    <div class="col-md-2">
                        <div class="text-right h-2x clr-red print-20x">-{{invoice.serviceTotalAmount.discountValue | currency}}</div>
                    </div>
                </div>
            </div--> 
            <!--div class="col-md-12 m-t20" ng-if="invoiceDetails.details.length == 1 && invoiceDetails.creditPaymentAdjustment">
                <div class="row">
                    <div class="col-md-6">
                        &nbsp;
                    </div>                   
                    <div class="col-md-4">
                        <div class="h-2x print-20x"><strong>Credit/Payment Adjustment</strong></div>            
                    </div>
                    <div class="col-md-2">
                        <div class="text-right h-2x clr-red print-20x">-{{invoiceDetails.creditPaymentAdjustment | currency}}</div>
                    </div>
                </div>
            </div-->
            
                <div class="col-md-12 m-t20" ng-if="invoiceDetails.details.length == 1 && invoiceDetails.subTotalAmount >=0">
                    <div class="row">
                        <div class="col-md-6">
                            &nbsp;
                        </div>                   
                        <div class="col-md-3">
                            <div class="h-2x print-20x"><strong>Subtotal</strong></div>            
                        </div>
                        <div class="col-md-3">
                            <div class="text-right h-2x print-20x">{{invoiceDetails.subTotalAmount | currency}}</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 m-t20" ng-if="invoiceDetails.details.length == 1">
                    <div class="row">
                        <div class="col-md-6">
                            &nbsp;
                        </div>
                        <div class="col-md-3">
                            <div class="row">
                                <div class="col-md-12 h-2x print-20x"><strong>Discount</strong> <div class="h-12x" ng-if="customerDiscountData.discountDataUpdated && customerDiscountData.discountTitle !=''">{{customerDiscountData.discountTitle}}</div>
                                    <div ng-if="customerDiscountData.discountDataUpdated && customerDiscountData.discountTitle!='' && invoiceDetails.invoiceStatus != 'Paid'">
                                        <a href="javascript:void(0)" class="h-1x remove-for-print" ng-click="removeDiscount()">remove</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 discount-td">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="discount-editer" ng-if="customerDiscountData.discountDataShow && !customerDiscountData.discountDataUpdated && customerDiscountData.addDiscountButton">
                                        <input 
                                        class="form-control small-input input-number discount-value" 
                                        mgminmax-validator 
                                        type="number" 
                                        name="discount-value" 
                                        ng-min="0" 
                                        ng-model="customerDiscountData.discountValue"
                                        ng-max="customerDiscountData.dtype == '%' ? 100 : 9999999" 
                                        required 
                                        ng-change="discountValueChange()"
                                        allow-typing="^[0-9. ]+$"
                                        ng-keypress="saveDiscountByInput($event)"
                                        />                     
                                        <div class="dropdown select-wrap label-dropdown discount-type">
                                        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">
                                            <b>{{customerDiscountData.dtype}}</b>
                                        <span class="caret"></span></button>
                                        <ul class="dropdown-menu scrollable-menu">
                                            <li ng-click="updateDiscountType('%')" ng-if="customerDiscountData.dtype!='%'"><a href="javascript:void(0)">%</a></li>
                                            <li ng-click="updateDiscountType('$')" ng-if="customerDiscountData.dtype!='$'"><a href="javascript:void(0)">$</a></li>
                                        </ul>
                                        </div>
                                        <div class="" style="position:absolute; width: 100%; z-index: 1; margin-top: -24px;">    
                                            <div ng-if="errorMsg">{{errorMsg}}"></div>
                                          </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="text-right h-2x">
                                        <div ng-class="{'clr-red':customerDiscountData.discountAmount>0 }" ng-if="customerDiscountData.discountDataUpdated && customerDiscountData.discountTitle!=''">{{customerDiscountData.discountAmount>0 ? '-':''}}{{customerDiscountData.discountAmount  | currency}}</div>
                                        <div  ng-if="!customerDiscountData.discountDataShow && !customerDiscountData.discountDataUpdated  && customerDiscountData.addDiscountButton && invoiceDetails.invoiceStatus != 'Paid'"><button class="discount-button remove-for-print" type="button" ng-click="showDiscountInput()">Add</button><div class="add-for-print print-20x" >{{0 | currency}}</div></div>
                                        <div ng-if="invoiceDetails.invoiceStatus == 'Paid' && customerDiscountData.discountTitle==''">{{0 | currency}}</div>
                                        <span class="remove-for-print" ng-if="customerDiscountData.discountDataShow && !customerDiscountData.discountDataUpdated  && customerDiscountData.addDiscountButton"> {{customerDiscountData.discountAmount  | currency}}</span>
                                        <button  ng-if="customerDiscountData.discountDataShow && !customerDiscountData.discountDataUpdated  && customerDiscountData.addDiscountButton" class="discount-save-button remove-for-print" type="button" ng-click="saveDiscount()">Save</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <error ng-if="errorDiscount" message="{{errorDiscount}}"></error>  
                </div>
                <div class="col-md-12 m-tb20" ng-if="invoiceDetails.details.length == 1" >
                    <div class="message-absolute discount-error" ng-if="customerTaxData.errorMsg">  <error  message="{{customerTaxData.errorMsg}}"></error></div>
                    <div class="row">
                        <div class="col-md-6">
                            &nbsp;
                        </div>
                        <div class="col-md-3">
                            <div class="h-2x print-20x"><strong>Tax</strong>
                                <div ng-if="customerTaxData.selectedTaxTitle != ''">
                                    <div class="h-12x">{{customerTaxData.selectedTaxTitle}}</div>
                                    <a href="javascript:void(0)" class="h-1x remove-for-print" ng-if="customerTaxData.addTaxButton" ng-click="removeTax()">remove</a>
                                </div>
                                
                            </div>
                        </div>
                        <div class="col-md-3" >
                            <div  ng-if="customerTaxData.selectedTaxValue==0 && customerTaxData.addTaxButton  && customerTaxData.selectedTaxTitle == ''" class="text-right h-2x">
                                <button  ng-disabled="customerTaxData.selectedTaxTitle != ''" class="tax-button remove-for-print" type="button"  ng-click="showTaxPopup()">Add</button>
                                <div class="add-for-print print-20x" >{{0 | currency}}</div></div>
                            <div  ng-if="customerTaxData.selectedTaxValue>0" class="text-right h-2x print-20x">{{customerTaxData.selectedTaxValue | currency}}</div> 
                            <div  ng-if="((customerTaxData.selectedTaxValue==null || customerTaxData.selectedTaxValue=='' || customerTaxData.selectedTaxValue==0) && !customerTaxData.addTaxButton) || (invoiceDetails.taxValue == 0 && customerTaxData.selectedTaxTitle != '')" class="text-right h-2x">{{0 | currency}}</div>
                            
                            <div ng-if="customerTaxData.taxDataPopup && customerTaxData.addTaxButton" class="tax-popup remove-for-print">
                                <span class="light-grey">{{customerTaxData.taxSettingArray.length > 0 ? "Select Tax Rate" : "No tax found! Add Tax from Settings"}}</span>
                                <ul>
                                    <li id="{{tax.id}}" ng-click="taxSelected(tax.id)" ng-repeat="tax in customerTaxData.taxSettingArray">{{tax.title}} ({{tax.amount}}%)</li>
                                </ul>   
                            </div>
                        </div>
                    </div>
                </div>

            <div class="col-md-12 {{invoiceDetails.details.length > 1 ? 'subtotal-box' :'m-t40' }}">
                <div class="row flex align-items-bottom">            
                    <div class="col-md-6"> </div>          
                    <div class="col-md-6 h-2-5x print-22x {{invoiceDetails.details.length > 1 ? 'd-small-text' :'' }}">
                        <div class="row">
                            <div class="col-xs-4"><span class=" print-22x  print-bold {{invoiceDetails.details.length == 1 ? 'bb' :'' }}" >{{invoiceDetails.details.length > 1 ? 'Subtotal' : 'TOTAL'}}</span></div>
                            <div class="col-xs-8 text-right"><strong class="darkGray print-22x "> <span ng-if="invoiceDetails.details.length == 1">{{invoiceDetails.totalAmount | currency}}</span> <span ng-if="invoiceDetails.details.length > 1">{{invoice.serviceTotalAmount.totalAmount | currency}}</span></strong> </div>
                        </div>
                        <div class="row print-20x print-bold"  ng-if="invoiceDetails.details.length == 1">
                            <div class="col-xs-8 print-22x">BALANCE DUE</div>
                            <div class="col-xs-4 print-22x text-right">{{invoiceDetails.balanceDue | currency}}</div>
                        </div>                  
                    </div>                    
                </div>
                <div class="row">
                    <div class="col-md-12 text-left m-t20">                        
                        <ng-container ng-if="invoiceDetails.details.length == 1">
                            <strong>Notes</strong>
                            <textarea placeholder="Invoice Notes" class="form-control remove-for-print" name="invoiceNotes" style="height: 51px!important;" row='1' ng-model="invoiceModel.invoiceNotes" maxLength="300" ng-blur="saveNotes(invoiceModel.invoiceNotes)">
                                {{invoiceModel.invoiceNotes}}
                            </textarea> 
                            <p  class="add-for-print print-notes"> {{invoiceModel.invoiceNotes}}</p>
                            
                        </ng-container>
                        <ng-container ng-if="invoiceDetails.jobId != null && invoiceDetails.jobId != ''">
                            <br/>
                            <p> <strong>Invoice created from <a href="javascript:void(0)" ng-click="sentToJobPage(invoiceDetails.jobId)">job #{{invoiceDetails.jobId}}</a> </strong> </p>
                        </ng-container>
                    </div>
                </div> 
            </div> 
        </div>   
        <!--div class="row" ng-if="invoiceDetails.details.length > 1 && invoiceDetails.creditPaymentAdjustment">
            <div class="col-md-12 m-t20 m-b20">
                <div class="row">
                    <div class="col-md-6">
                        &nbsp;
                    </div>                   
                    <div class="col-md-4">
                        <div class="h-2x print-20x"><strong>Credit/Payment Adjustment</strong></div>            
                    </div>
                    <div class="col-md-2">
                        <div class="text-right h-2x clr-red print-20x">-{{invoiceDetails.creditPaymentAdjustment | currency}}</div>
                    </div>
                </div>
            </div>
        </div-->
        <div class="row">
            <div class="col-md-12 m-tb20" ng-if="invoiceDetails.details.length > 1 && invoiceDetails.subTotalAmount">
                <div class="row">
                    <div class="col-md-6">
                        &nbsp;
                    </div>                   
                    <div class="col-md-3">
                        <div class="h-2x print-20x"><strong>Subtotal</strong></div>            
                    </div>
                    <div class="col-md-3">
                        <div class="text-right h-2x print-20x">{{invoiceDetails.subTotalAmount | currency}}</div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-md-12 m-t20" ng-if="invoiceDetails.details.length > 1">
                <div class="message-absolute discount-error" ng-if="customerDiscountData.errorMsg">  <error  message="{{customerDiscountData.errorMsg}}"></error></div>
                <div class="row">
                    <div class="col-md-6">
                        &nbsp;
                    </div>
                    <div class="col-md-3">
                        <div class="row">
                            <div class="col-md-12 h-2x print-20x"><strong>Discount</strong> <span class="h-2x text-muted" ng-if="customerDiscountData.discountDataUpdated && (customerDiscountData.dtype=='%' || customerDiscountData.discountTitle.charAt(0)!='$')">{{customerDiscountData.discountTitle}}</span>
                                <div ng-if="customerDiscountData.discountTitle!=''">
                                    <a href="javascript:void(0)"  class="h-1x remove-for-print" ng-click="removeDiscount()">remove</a>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="col-md-3 discount-td">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="discount-editer" ng-if="customerDiscountData.discountDataShow && !customerDiscountData.discountDataUpdated && customerDiscountData.addDiscountButton">
                                    <input 
                                    class="form-control small-input input-number discount-value" 
                                    mgminmax-validator 
                                    type="number" 
                                    name="discount-value" 
                                    ng-min="0" 
                                    ng-model="customerDiscountData.discountValue"
                                    ng-max="customerDiscountData.dtype == '%' ? 100 : 9999999" 
                                    required 
                                    ng-class="{'has-error':customerDiscountData.errorMsg }"
                                    ng-change="discountValueChange()"
                                    allow-typing="^[0-9. ]+$"
                                    ng-keypress="saveDiscountByInput($event)"
                                     />    
                                     <error ng-if="errorDiscount" message="{{errorDiscount}}"></error>                          
                                    <div class="dropdown select-wrap label-dropdown discount-type">
                                    <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">
                                        <b>{{customerDiscountData.dtype}}</b>
                                    <span class="caret"></span></button>
                                    <ul class="dropdown-menu scrollable-menu">
                                        <li ng-click="updateDiscountType('%')" ng-if="customerDiscountData.dtype!='%'"><a href="javascript:void(0)">%</a></li>
                                        <li ng-click="updateDiscountType('$')" ng-if="customerDiscountData.dtype!='$'"><a href="javascript:void(0)">$</a></li>
                                    </ul>
                                    </div> 
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="text-right h-2x">
                                    <div class="clr-red" ng-if="customerDiscountData.discountDataUpdated"> -{{customerDiscountData.discountAmount  | currency}}</div>
                                    <div class="clr-red" ng-if="!customerDiscountData.discountDataUpdated && !customerDiscountData.addDiscountButton"> -{{customerDiscountData.discountAmount  | currency}}</div>
                                    <button  ng-if="!customerDiscountData.discountDataShow && !customerDiscountData.discountDataUpdated  && customerDiscountData.addDiscountButton" class="discount-button remove-for-print" type="button" ng-click="showDiscountInput()">Add</button>
                                    <span class="remove-for-print" ng-if="customerDiscountData.discountDataShow && !customerDiscountData.discountDataUpdated  && customerDiscountData.addDiscountButton"> {{customerDiscountData.discountAmount  | currency}}</span>
                                    <button  ng-if="customerDiscountData.discountDataShow && !customerDiscountData.discountDataUpdated  && customerDiscountData.addDiscountButton" class="discount-save-button remove-for-print" type="button" ng-click="saveDiscount()">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12 m-tb20" ng-if="invoiceDetails.details.length > 1 && customerTaxData.taxSettingArray.length > 0">
                <div class="row">
                    <div class="col-md-6">
                        &nbsp;
                    </div>
                    <div class="col-md-3">
                        <div class="h-2x print-20x"><strong>Tax</strong>
                            <div ng-if="customerTaxData.selectedTaxValue>0 && customerTaxData.selectedTaxTitle == ''">
                                <div class="h-12x">{{customerTaxData.selectedTaxTitle}}</div>
                                <a href="javascript:void(0)" class="h-1x remove-for-print" ng-if="customerTaxData.addTaxButton" ng-click="removeTax()">remove</a>
                            </div>
                            
                        </div>
                    </div>
                    <div class="col-md-3" >
                        <div  ng-if="customerTaxData.selectedTaxValue==0 && customerTaxData.addTaxButton" class="text-right h-2x"><button class="tax-button remove-for-print" type="button"  ng-click="showTaxPopup()">Add</button></div>
                        <div  ng-if="customerTaxData.selectedTaxValue>0" class="text-right h-2x">{{customerTaxData.selectedTaxValue | currency}}</div> 
                        <div  ng-if="!customerTaxData.selectedTaxValue && !customerTaxData.addTaxButton" class="text-right h-2x">{{0 | currency}}</div>                            
                        <div ng-if="customerTaxData.taxDataPopup && customerTaxData.addTaxButton" class="tax-popup remove-for-print">
                            <span class="light-grey">Select Tax Rate</span>
                            <ul>
                                <li id="{{tax.id}}" ng-click="taxSelected(tax.id)" ng-repeat="tax in customerTaxData.taxSettingArray">{{tax.title}} ({{tax.amount}}%)</li>
                            </ul>   
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        
        <div class="row flex align-items-bottom" ng-if="invoiceDetails.details.length > 1">            
            <div class="col-md-6 text-left"> 
                <textarea placeholder="Invoice Notes" class="form-control remove-for-print" name="invoiceNotes" style="height: 54px!important;" row='1' ng-model="invoiceModel.invoiceNotes" maxLength="300" ng-blur="saveNotes(invoiceModel.invoiceNotes)">
                    {{invoiceModel.invoiceNotes}}
                </textarea> 
                <p class="add-for-print print-notes"> {{invoiceModel.invoiceNotes}}</p>
            </div>  
            <div class="col-md-6 h-2-5x print-22x">
                <div class="row">
                    <div class="col-xs-4"><span class=" print-22x  print-bold bb" >TOTAL</span></div>
                    <div class="col-xs-8 text-right"><strong class="darkGray print-22x ">{{invoiceDetails.totalAmount | currency}}</strong> </div>
                </div>
                <div class="row print-20x print-bold">
                    <div class="col-xs-8 print-22x">BALANCE DUE</div>
                    <div class="col-xs-4 print-22x text-right">{{invoiceDetails.balanceDue | currency}}</div>
                </div>                  
            </div>                     
        </div>
        
    </div>
    <div class="remove-for-print p-relative" id="bottom-section-error" >
        <div style="position: absolute; z-index: 1; left: 0px; top: -30px; right: 0; padding: 0px; ">
            <error ng-if="errorBottom" message="{{errorBottom}}"></error>
        </div>
    </div>
    <div class="remove-for-print" ng-controller="invoicePaymentAppliedListController" ng-include="'/templates/component/invoice-payment-applied-list.html?ver='+PB_WEB_VERSION"></div>
</div>


<script type="text/ng-template" id="selectPaymentMethodPopup.html">
    <div class="dataTables_wrapper modal-box common-popup add-service-level-popup" style="width:370px" ng-init="getPayaSettings()">  
      <div ng-if="isApiProcessing" class="transparent-bg-fixed"></div>
      <div class="spinner" ng-if="isProcessing" style="border:none; position: fixed;">
        <div class="spinner-item">
          <div class="spinner-animation"><img border="0" src="resources/images/spinner.gif" /></div>
        </div>
      </div>
      <div class="popup-header">
        <span class="heading">{{ paymentSuccess ? '&nbsp;&nbsp;&nbsp;&nbsp;Success' : 'Add Payment'}}</span>
        <div class="popup-close" ng-click="closeThisDialog('')"><i class="fa fa-times-circle" aria-hidden="true"></i></div>
      </div>   
      <div class="" style="position:absolute; width: 100%; z-index: 1; margin-top: -10px;">     
       
        <div class="payment-error" ng-if="paymentError" >
            <div ng-repeat="(key, value) in paymentError">
                <div ng-repeat="item in value">{{item}}</div>
            </div>
        </div> 
      </div> 
      <form ng-show="!paymentSuccess" class="set-chem-form" name="paymentForm" autocomplete="off" ng-submit="paymentForm.$valid && checkPaymentType(model)" novalidate>      
     
        <div class="detail-box">         
          <div class="grid text-left colored-scroll-bar" style="height: 350px; overflow: auto;">
            <div class="col-12-12">                 
                <div class="formGroup">
                    <label >Payment Method<span class="clr-red">*</span> </label>
                    <div class="dropdown select-wrap ">
                      <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown"  >
                        <b ng-bind-html="selectedPaymentMethod ? selectedPaymentMethod : '--'" ></b>
                      <span class="caret"></span></button>
                      <ul class="dropdown-menu scrollable-menu"> 
                        <li ng-if="payaStatus==1" ng-hide="model.paymentMethod == 'cc'" ng-click="model.paymentMethod = 'cc'; selectPaymentMethod('Credit Card')"><a href="javascript:void(0)">Credit Card</a></li>
                        <li ng-if="payaStatus==1" ng-hide="model.paymentMethod == 'ach'" ng-click="model.paymentMethod = 'ach'; selectPaymentMethod('ACH')"><a href="javascript:void(0)">ACH</a></li>
                        <li ng-hide="model.paymentMethod == 'check'" ng-click="model.paymentMethod = 'check'; selectPaymentMethod('Check');"><a href="javascript:void(0)">Check</a></li>
                        <li ng-hide="model.paymentMethod == 'cash'" ng-click="model.paymentMethod = 'cash'; selectPaymentMethod('Cash');"><a href="javascript:void(0)">Cash</a></li> 
                        <li ng-if="paymentProfiles.length > 0" class="dropdown-divider"></li>
                        <div class="p-10 text-center light-blue" ng-if="payaStatus!=1">Want to accept credit cards and ACH payments?<br/>
                            activate your payments account in settings
                          </div>
                        <h4 ng-if="paymentProfiles.length > 0" class="dropdown-header">Saved Payment Method</h4>
                        <li 
                          ng-repeat="profile in paymentProfiles" 
                          ng-hide="model.paymentMethod == profile.id" 
                          ng-click="model.paymentMethod = profile.id;  selectPaymentMethod(profile.id)">
                          <a href="javascript:void(0)">{{profile.paymentProfileName}} <small>({{(profile.paymentMethod == 'ach' ? 'ACH ' : '')}}{{(profile.paymentMethod == 'cc' ? profile.accountType : '') | uppercase }} x{{profile.accountLastFourDigits}})</small></a>
                        </li> 
                      </ul>
                      
                      
                    </div>                    
                </div> 
                 
                <div class="formGroup" ng-if="model.paymentMethod == 'check'" >
                    <label >Check Number<span class="clr-red">*</span> </label>
                    <input type="text" name="checkNumber" class="form-control" ng-model="model.checkNumber" maxlength="50"  ng-required="model.paymentMethod == 'check'" >
                    <span class="has-required" ng-show="paymentForm.$submitted && model.paymentMethod == 'check' && paymentForm.checkNumber.$invalid">Please enter check number</span>
                  </div>
              <div class=" formGroup" ng-if="model.paymentMethod == 'check' || model.paymentMethod == 'cash'" >
                <label >Notes </label>
                <textarea class="form-control" name="notes" style="height: 140px!important;" row='1' ng-model="model.notes" maxLength="300">{{model.notes}}</textarea>
                <span class="c-limit">Characters limit: 300</span>             
              </div>            
            </div>
          </div>  

          <div class="text-center p-t20 m-b20">         
            <span><button class="add-button" type="submit" ng-click="payRefundForm.submitAttempt=true;" >{{model.paymentMethod == 'check' || model.paymentMethod == 'cash' ? 'SAVE' : 'CONTINUE'}}</button></span>              
          </div> 
        
        </div>
      </form> 
      
    </div>
  </script>


  <script type="text/ng-template" id="sentEmailPopup.html">
    <div class="dataTables_wrapper modal-box common-popup add-service-level-popup" style="width:370px">  
      <div ng-if="isApiProcessing" class="transparent-bg-fixed"></div>
      <div class="spinner" ng-if="isProcessing" style="border:none; position: fixed;">
        <div class="spinner-item">
          <div class="spinner-animation"><img border="0" src="resources/images/spinner.gif" /></div>
        </div>
      </div>
      <div class="popup-header">
        <span class="heading">Email Invoice</span>
        <div class="popup-close" ng-click="closeThisDialog('')"><i class="fa fa-times-circle" aria-hidden="true"></i></div>
      </div>   
      <div class="" style="position:absolute; width: 100%; z-index: 1; margin-top: -24px;">    
        <error ng-if="sentEmailError" message="{{sentEmailError}}"></error>
      </div>
      <form class="set-chem-form" name="sentEmailForm" autocomplete="off" ng-submit="sentEmailForm.$valid && emailInvoice(sentEmailModel)" novalidate>
          
        <div class="detail-box">         
          <div class="grid text-left box" >
            <div class="col-12-12">                 
                <div class="formGroup">
                    <label>Email Address</label>
                    <input 
                        type="email" 
                        autocomplete="off" 
                        class="form-control" 
                        ng-model="sentEmailModel.email" 
                        placeholder="Email Address" 
                        name="emailId" 
                        ng-maxlength="100" 
                        ng-minlength="6" 
                        ng-pattern='/^[^<>()[\]\\,;:\%#^\s@\"$&!@]+@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z0-9\d-_]+\.)+[a-zA-Z\d-_]{2,}))$/' 
                        ng-class="{'has-error': sentEmailForm.$submitted && sentEmailForm.emailId.$invalid || sentEmailForm.emailId.$touched && loginForm.emailId.$invalid}"
                        required                         
                    />
                </div>     
            </div>
          </div>      
          <div class="text-center p-t20">
            <button class="add-button" ng-click="closeThisDialog()" type="button">CANCEL</button>
            <span class="p-l10"><button class="add-button" type="submit" ng-click="sentEmailForm.submitAttempt=true;" >SEND EMAIL</button></span>            
          </div>        
        </div>
      </form> 
    
    </div>
  </script>

  <script type="text/ng-template" id="payaPaymentPopup.html">
    <div class="dataTables_wrapper modal-box common-popup add-service-level-popup" style="width:370px; min-height:300px">  
      <div ng-if="isApiProcessing" class="transparent-bg-fixed"></div>
      <div class="spinner" ng-if="isProcessing" style="border:none; position: fixed;">
        <div class="spinner-item">
          <div class="spinner-animation"><img border="0" src="resources/images/spinner.gif" /></div>
        </div>
      </div>  
      <div class="popup-header">
        <span class="heading">Pay by {{model.paymentMethod == 'ach' ? 'ACH' : 'Credit Card'}}</span>
        <div class="popup-close" ng-click="closeThisDialog('')"><i class="fa fa-times-circle" aria-hidden="true"></i></div>
      </div>  
      <div class="detail-box">         
        <div class="grid text-left box colored-scroll-bar" style="max-height:437px; overflow: auto;">
          <div id="ccIframeContainer" class="pay-form-container"></div>  
          <div id="achIframeContainer" class="pay-form-container"></div>    
        </div>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="payaErrorPopup.html">
    <div class="dataTables_wrapper modal-box common-popup add-service-level-popup" style="width:370px; min-height:200px">  
      <div ng-if="isApiProcessing" class="transparent-bg-fixed"></div>
   
      <div class="popup-header">
        <span class="heading">Error Code <small ng-if="payaErrorCode">- {{payaErrorCode}}</small></span>
        <div class="popup-close" ng-click="closeThisDialog('')"><i class="fa fa-times-circle" aria-hidden="true"></i></div>
      </div>  
      <div class="detail-box text-center">         
        <div class="grid box clr-red p-tb20 text-center" style="max-height:300px; overflow: auto;"> 
            Transaction is declined.
        </div>
        <button class="btn btn-primary" ng-click="closeThisDialog('')">OK</div>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="deleteInvoiceConfirm.html">
    <div class="dataTables_wrapper modal-box common-popup" style="width:400px; ">
      <div class="popup-header text-left">
        <span class="heading">Confirm</span>
        <div class="popup-close" ng-click="closeThisDialog('')"><i class="fa fa-times-circle" aria-hidden="true"></i></div>
      </div>
       <div class="popup-body text-center">
         <div class="row-container">
           <div><label>Do you want to permanently delete this invoice and all data associated with it?    This cannot be undone.</label></div>
           <br />
           <div class="set-chem-button m-b20" style="text-align: center;">
             <button class="add-button" type="submit" ng-click="closeThisDialog()">CANCEL</button>&nbsp;
             <button class="add-button btn-red" type="submit" ng-click="deleteInvoice()">DELETE</button>
           </div>
         </div>
       </div>
   
    </div>
   </script>